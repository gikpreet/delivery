= 관리 ID (Managed ID)

Azure 관리 ID는 Azure 리소스에 할당되는 **Microsoft Entra ID(구 Azure Active Directory) 기반의 서비스 주체(Service Principal)**입니다. 이 서비스 주체의 자격 증명(Credential)은 전적으로 Azure 플랫폼에 의해 **자동으로 관리(생성, 순환, 삭제)**되므로, 개발자가 코드나 구성 파일에서 자격 증명을 직접 관리할 필요가 없어집니다.

== 작동 메커니즘

관리 ID의 핵심은 **Azure Instance Metadata Service (IMDS)**와 **OAuth 2.0 클라이언트 자격 증명 흐름(Client Credentials Flow)**을 통해 작동합니다.

1. 토큰 요청 +
관리 ID가 활성화된 Azure 리소스(예: VM, App Service)의 코드가 Azure Key Vault 같은 다른 서비스에 접근해야 할 때, 먼저 로컬의 IMDS 엔드포인트로 REST API 호출을 보냅니다. 이 엔드포인트는 외부로 라우팅되지 않는 고정 IP 주소(169.254.169.254)를 가집니다.
+
`GET http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://vault.azure.net`
+
2. 토큰 발급 +
IMDS는 해당 리소스의 관리 ID 정보를 기반으로 Microsoft Entra ID에 **액세스 토큰(Access Token)**을 대신 요청합니다. Entra ID는 해당 서비스 주체를 인증하고, 요청된 대상 리소스(Audience)에 대한 JWT(JSON Web Token) 형식의 액세스 토큰을 발급하여 IMDS를 통해 리소스에 전달합니다.
3. 리소스 접근 +
코드는 받은 액세스 토큰을 HTTP Authorization 헤더에 'Bearer' 토큰으로 포함하여 목표 서비스(Key Vault)의 API를 호출합니다.
4. 토큰 검증 및 권한 부여 +
Key Vault는 이 토큰이 신뢰할 수 있는 발급자(Microsoft Entra ID)로부터 서명되었는지 검증합니다. 검증이 완료되면, 토큰에 명시된 서비스 주체(관리 ID)가 자신에게 필요한 Azure RBAC 역할(예: Key Vault 비밀 사용자)을 가지고 있는지 확인하고, 권한이 있으면 요청된 작업을 수행하도록 허용합니다.

== 관리 ID의 종류

[cols="1,3,4", options="header"]
|===
|구분|시스템 할당 관리 ID(System-Assigned)|사용자 할당 관리(User-Assigned)
|생성 및 수명 주기|Azure 리소스 생성 시 활성화하며, 리소스의 수명 주기에 종속적입니다. 리소스가 삭제되면 ID도 함께 삭제됩니다.|독립적인 Azure 리소스로 먼저 생성합니다. 리소스와 독립적인 수명 주기를 가집니다.
|관계|1:1 관계. 하나의 ID는 오직 하나의 Azure 리소스에만 연결됩니다.|1:N 관계. 하나의 ID를 여러 Azure 리소스에 공유하여 할당할 수 있습니다.
|서비스 주체|리소스 생성 시 백그라운드에서 서비스 주체가 자동으로 생성됩니다.|사용자 할당 ID 리소스를 생성할 때 명시적으로 서비스 주체가 생성됩니다.
|주요 사용 사례|단일 VM이나 App Service처럼 하나의 리소스에 대한 ID가 필요할 때 사용합니다.|가상 머신 확장 집합(VMSS)의 모든 인스턴스가 동일한 ID를 공유하거나, 리소스가 생성되기 전에 미리 권한을 설정해야 할 때 유용합니다.
|===

---

